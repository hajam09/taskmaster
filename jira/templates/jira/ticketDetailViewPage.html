{% extends "accounts/base.html" %}
{% load static %}
{% block content %}

    <link type="text/css" rel="stylesheet" href="{% static 'css/ticketPageCss1.css' %}" media="all">
    <link type="text/css" rel="stylesheet" href="{% static 'css/ticketPageCss2.css' %}" media="all">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">

    <div class="modal fade bd-example-modal-lg" id="editTicketModal" tabindex="-1" role="dialog"
         aria-labelledby="myLargeModalLabel" aria-hidden="true" style="color: black;">
        <div class="modal-dialog" role="document" style="max-width: 1000px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Edit Issue: {{ ticket.internalkey }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="project-add-details" role="tabpanel">
                                <dl class="row">
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Summary</label>
                                        <input class="form-control col" type="text" placeholder="Summary" name="summary"
                                               value="{{ ticket.summary }}"
                                               required>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Issue type</label>
                                        <select id="ticketIssueType" data-show-content="true"
                                                class="form-control" name="ticketIssueType">
                                            {% for jp in ticketIssueTypes %}
                                                {% if jp.code == ticket.issueType.code %}
                                                    <option data-content="<img src='{{ jp.icon }}' width='20' height='20'>&nbsp; {{ jp.internalKey }}"
                                                            selected="selected"
                                                            value="{{ jp.id }}">{{ jp.internalKey }}</option>
                                                {% else %}
                                                    <option data-content="<img src='{{ jp.icon }}' width='20' height='20'>&nbsp; {{ jp.internalKey }}"
                                                            value="{{ jp.id }}">{{ jp.internalKey }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </dd>
                                </dl>
                                <hr>
                                <dl class="row">

                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Priority</label>
                                        <select id="ticketPriorities" data-show-content="true"
                                                class="form-control" name="priority">
                                            {% for jp in ticketPriorities %}
                                                {% if jp.code == ticket.priority.code %}
                                                    <option data-content="<img src='{{ jp.icon }}' width='20' height='20'>&nbsp; {{ jp.internalKey }}"
                                                            selected="selected"
                                                            value="{{ jp.id }}">{{ jp.internalKey }}</option>
                                                {% else %}
                                                    <option data-content="<img src='{{ jp.icon }}' width='20' height='20'>&nbsp; {{ jp.internalKey }}"
                                                            value="{{ jp.id }}">{{ jp.internalKey }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Components</label>
                                        <select class="form-control select2bs4" multiple="multiple" name="components"
                                                style="width: 100%">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Labels</label>
                                        <select class="form-control select2bs4" multiple="multiple" name="labels"
                                                style="width: 100%">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Story Points</label>
                                        <input class="form-control col" type="text" placeholder="Story Points"
                                               name="storyPoints" value="{{ ticket.storyPoints }}"
                                               required>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Fix Version</label>
                                        <input class="form-control col" type="text" placeholder="Fix Version"
                                               name="fixVersion" value="{{ ticket.fixVersion }}"
                                               required>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Attachment</label>
                                        <div class="file-drop-area border justify-content-center" style="width: 100%;">
                                            <span class="choose-file-button">Choose files</span>
                                            <span class="file-message">or drag and drop files here</span>
                                            <input class="file-input" name="attachments" type="file" multiple>
                                        </div>
                                    </dd>
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Description</label>
                                        <textarea class="form-control col" rows="5" name="description"
                                                  required>{{ ticket.description }}</textarea>
                                    </dd>
                                </dl>
                                <hr>
                                <dl class="row">
                                    <dd class="col-sm-12">
                                        <label style="font-size: 85%; color: #6c757d;">Assignee</label>
                                        <select id="assignee" data-show-content="true" class="form-control"
                                                name="assignee">
                                            {% for p in allProfiles %}
                                                {% if p.user == ticket.assignee %}
                                                    <option data-content="<img src='{{ p.profilePicture.url }}' width='20' height='20'>&nbsp; {{ p.user.get_full_name }}"
                                                            selected="selected"
                                                            value="{{ p.user.id }}">{{ p.user.get_full_name }}</option>
                                                {% else %}
                                                    <option data-content="<img src='{{ p.profilePicture.url }}' width='20' height='20'>&nbsp; {{ p.user.get_full_name }}"
                                                            value="{{ p.user.id }}">{{ p.user.get_full_name }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input class="btn btn-primary" type="submit" style="background-color: #0052cc" value="Update">
                        <button class="btn btn-secondary" type="reset" data-dismiss="modal">Cancel</button>

                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="issue-container">
        <div id="issue-content" class="issue-edit-form">
            <header id="stalker" class="issue-header js-stalker">
                <div class="issue-header-content">
                    <div class="aui-page-header">
                        <div class="aui-page-header-inner">
                            <div class="aui-page-header-image">
                                <span id="10172" class="aui-avatar aui-avatar-large aui-avatar-project">
                                    <span class="aui-avatar-inner">
                                        <img id="project-avatar"
                                             alt="Uploaded image for project: '{{ ticket.project.internalKey }}'"
                                             src="{{ ticket.project.icon.url }}">
                                    </span>
                                </span>
                            </div>
                            <div class="aui-page-header-main">
                                <ol class="aui-nav aui-nav-breadcrumbs" resolved="">
                                    <li>
                                        <a id="project-name-val"
                                           href="{% url 'jira:project-issues' ticket.project.code %}"
                                           class="">{{ ticket.project.internalKey }}</a>
                                    </li>
                                    <li>
                                        <a class="issue-link" data-issue-key="{{ ticket.getTicketUrl }}"
                                           href="{{ ticket.getTicketUrl }}" id="key-val"
                                           rel="215653">{{ ticket.internalKey }}</a>
                                    </li>
                                </ol>
                                <h1 id="summary-val">{{ ticket.summary }} </h1>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="issue-body-content">
                <div class="aui-group issue-body">
                    <div class="aui-item issue-main-column">
                        <div id="details-module" class="module toggle-wrap">
                            <div id="details-module_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Details"
                                        aria-controls="details-module" aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="details-module-label">Details</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <ul id="issuedetails" class="property-list two-cols">
                                    <li class="item">
                                        <div class="wrap">
                                            <strong class="name" title="Type">
                                                <label for="issuetype">Type:</label>
                                            </strong>
                                            <span id="type-val" class="value">
                                                <img alt="" height="16" src="{{ ticket.issueType.icon }}"
                                                     title="{{ ticket.issueType.internalKey }}"
                                                     width="16"> {{ ticket.issueType.internalKey }}
                                            </span>
                                        </div>
                                    </li>
                                    <li class="item item-right">
                                        <div class="wrap">
                                            <strong class="name" title="Status">Status:</strong>
                                            <span id="status-val" class="value">
                                                <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-yellow jira-issue-status-lozenge-indeterminate jira-issue-status-lozenge-max-width-medium"
                                                      style="background-color: {{ ticket.column.colour }}; color: black;">
                                                    {{ ticket.column.internalKey }}
                                                </span>
                                            </span>
                                        </div>
                                    </li>
                                    <li class="item new">
                                        <div class="wrap">
                                            <strong class="name" title="Priority">
                                                <label for="priority-field">Priority:</label>
                                            </strong>
                                            <span id="priority-val" class="value">
                                                <img alt="" height="16" src="{{ ticket.priority.icon }}"
                                                     title="{{ ticket.priority.internalLey }}"
                                                     width="16"> {{ ticket.priority.internalKey }}
                                            </span>
                                        </div>
                                    </li>
                                    <!-- TODO -->
                                    <li class="item item-right">
                                        <div class="wrap">
                                            <strong class="name" title="Resolution">Resolution:</strong>
                                            <span id="resolution-val" class="value unresolved"> Unresolved </span>
                                        </div>
                                    </li>
                                    <li class="item">
                                        <div class="wrap">
                                            <strong class="name" title="Component/s">
                                                <label for="components">Component/s:</label>
                                            </strong>
                                            <span id="components-val" class="value">
                                              <span class="shorten" id="components-field" resolved=""
                                                    style="height: auto;">
                                                  <!-- TODO -->
                                                  <a href="/issues/?jql=project+%3D+JENKINS+AND+component+%3D+core"
                                                     title="core Jenkins core">{{ ticket.component.internalKey }}</a>
                                              </span>
                                          </span>
                                        </div>
                                    </li>
                                    <!-- TODO -->
                                    <li class="item full-width">
                                        <div class="wrap" id="wrap-labels">
                                            <strong class="name" title="Labels"> <label
                                                    for="labels-textarea">Labels:</label> </strong>
                                            <div class="labels-wrap value">
                                                {% for label in ticket.label.all %}
                                                    <a href="/issues/?jql=labels+%3D+regression" class="aui-lozenge"
                                                       style="background-color: #DFE1E5; color: black;"
                                                       title="{{ label.internalKey }}">
                                                        {{ label.internalKey }}
                                                    </a>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div id="descriptionModule" class="module toggle-wrap">
                            <div id="descriptionModule_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Description"
                                        aria-controls="descriptionModule" aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="descriptionmodule-label">Description</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <div id="description-val" class="field-ignore-highlight">
                                    <div class="user-content-block">
                                        {{ ticket.description|linebreaks }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="dnd-metadata" class="module toggle-wrap">
                            <div id="dnd-metadata_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Attachments"
                                        aria-controls="dnd-metadata" aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="dnd-metadata-label">Attachments</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software"
                                     data-upload-limit="10485760" data-thumbnails-allowed="true"></div>
                            </div>
                        </div>
                        <div id="attachmentmodule" class="module toggle-wrap">
                            <div id="attachmentmodule_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Attachments"
                                        aria-controls="attachmentmodule" aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="attachmentmodule-label">Attachments</h4>
                                <ul class="ops">
                                    <li class="drop">
                                        <div class="aui-dd-parent">
                                            <button class="aui-button aui-button-compact aui-button-subtle js-default-dropdown"
                                                    title="Options" aria-label="Attachments panel options" resolved=""
                                                    id="AJS_DROPDOWN__4" aria-controls="AJS_DROPDOWN__4_drop"
                                                    aria-haspopup="true" aria-expanded="false"><span
                                                    class="aui-icon aui-icon-small aui-iconfont-more">Options</span>
                                            </button>
                                            <div class="aui-dropdown-content aui-list">
                                                <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                                                    <li class="aui-list-item"><a id="attachment-sort-key-name"
                                                                                 href="/browse/JENKINS-68799?attachmentSortBy=fileName#attachmentmodule"
                                                                                 class="aui-list-checked aui-checked aui-list-item-link"
                                                                                 title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a>
                                                    </li>
                                                    <li class="aui-list-item"><a id="attachment-sort-key-date"
                                                                                 href="/browse/JENKINS-68799?attachmentSortBy=dateTime#attachmentmodule"
                                                                                 class="aui-list-checked aui-list-item-link"
                                                                                 title="Sort By Date"><span>Sort By Date</span></a>
                                                    </li>
                                                </ul>
                                                <ul id="attachment-sorting-order-options" class="aui-list-section">
                                                    <li class="aui-list-item"><a id="attachment-sort-direction-asc"
                                                                                 href="/browse/JENKINS-68799?attachmentOrder=asc#attachmentmodule"
                                                                                 class="aui-list-checked aui-checked aui-list-item-link"
                                                                                 title="Ascending"><span>Ascending</span></a>
                                                    </li>
                                                    <li class="aui-list-item"><a id="attachment-sort-direction-desc"
                                                                                 href="/browse/JENKINS-68799?attachmentOrder=desc#attachmentmodule"
                                                                                 class="aui-list-checked aui-list-item-link"
                                                                                 title="Descending"><span>Descending</span></a>
                                                    </li>
                                                </ul>
                                                <ul id="attachment-view-mode-options" class="aui-list-section">
                                                    <li class="aui-list-item"><a id="attachment-view-mode-gallery"
                                                                                 href="/browse/JENKINS-68799?attachmentViewMode=gallery#attachmentmodule"
                                                                                 class="aui-list-checked aui-checked aui-list-item-link"
                                                                                 title="Thumbnails"><span>Thumbnails</span></a>
                                                    </li>
                                                    <li class="aui-list-item"><a id="attachment-view-mode-list"
                                                                                 href="/browse/JENKINS-68799?attachmentViewMode=list#attachmentmodule"
                                                                                 class="aui-list-checked aui-list-item-link"
                                                                                 title="List"><span>List</span></a></li>
                                                </ul>
                                                <ul id="attachment-manage-options" class="aui-list-section aui-last">
                                                    <li class="aui-list-item"><a id="aszip"
                                                                                 href="/secure/attachmentzip/215653.zip"
                                                                                 class="aui-list-checked aui-list-item-link"
                                                                                 title="Download all attachments as a ZIP file"><span>Download All</span></a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="mod-content">
                                <ol id="attachment_thumbnails" class="item-attachments" data-sort-key="fileName"
                                    data-sort-order="asc">
                                    <!-- TODO: Implement carousel and ordering -->
                                    {% for attachment in ticket.ticketAttachments.all %}
                                        <li class="attachment-content js-file-attachment" draggable="true"
                                            data-downloadurl="image/png:image-2022-06-21-21-22-35-447.png:https://issues.jenkins.io/secure/attachment/58242/image-2022-06-21-21-22-35-447.png"
                                            data-issue-id="{{ attachment.id }}" data-attachment-type="image"
                                            data-attachment-thumbnail="true">
                                            <div class="attachment-thumb">
                                                <a href="/secure/attachment/58242/image-2022-06-21-21-22-35-447.png"
                                                   title="image-2022-06-21-21-22-35-447.png - Latest 2022-06-21 19:22 - Bartosz Nowak"
                                                   file-preview-id="{{ attachment.id }}"
                                                   file-preview-title="image-2022-06-21-21-22-35-447.png"
                                                   file-preview-type="image"
                                                   file-preview-url="https://issues.jenkins.io/secure/thumbnail/58242/_thumb_58242.png"
                                                   resolved="">
                                                    <img loading="lazy"
                                                         src="{{ attachment.attachment.url }}"
                                                         alt="image-2022-06-21-21-22-35-447.png">
                                                </a>
                                            </div>
                                            <dl>
                                                <dt>
                                                    <span class="blender"></span>
                                                    <a
                                                            href="/secure/attachment/58242/image-2022-06-21-21-22-35-447.png"
                                                            class="attachment-title"
                                                            title="image-2022-06-21-21-22-35-447.png - Latest 2022-06-21 19:22 - Bartosz Nowak"
                                                            file-preview-id="58242"
                                                            file-preview-title="image-2022-06-21-21-22-35-447.png"
                                                            file-preview-type="image"
                                                            file-preview-url="https://issues.jenkins.io/secure/thumbnail/58242/_thumb_58242.png"
                                                            resolved="">{{ attachment.internalKey }}</a></dt>
                                                <!-- TODO: Fix file size -->
                                                <dd class="attachment-size">{{ attachment.attachment.size }} kB</dd>
                                                <dd class="attachment-date">
                                                    <time className="livestamp"
                                                          dateTime="{{ attachment.createdDttm }}">{{ attachment.createdDttm|date:'Y-m-d H:i' }}
                                                    </time>
                                                </dd>
                                            </dl>
                                        </li>
                                    {% endfor %}
                                </ol>
                            </div>
                        </div>
                        <div id="linkingmodule" class="module toggle-wrap">
                            <div id="linkingmodule_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Issue Links"
                                        aria-controls="linkingmodule" aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="linkingmodule-label">Issue Links</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <div class="links-container" data-default-link-icon="/images/icons/generic_link_16.png">
                                    <dl class="links-list ">
                                        <dt title="links to">links to</dt>
                                        <dd id="remote-27862" data-remote-link-id="27862" class="remote-link">
                                            <div class="link-content">
                                                <p>
                                                    <img src="https://github.com/favicon.ico" width="16" height="16"
                                                         title="Web Link" alt="Web Link">
                                                    <span title="https://github.com/jenkinsci/jenkins/pull/6691">
                                                        <a href="https://github.com/jenkinsci/jenkins/pull/6691"
                                                           class="link-title" target="_blank" rel="noopener">https://github.com/jenkinsci/jenkins/pull/6691</a>
                                                        <span class="link-summary"></span>
                                                    </span>
                                                </p>
                                                <ul class="link-snapshot">
                                                </ul>
                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        <div id="activitymodule" class="module toggle-wrap">
                            <div id="activitymodule_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Activity"
                                        aria-controls="activitymodule" aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="activitymodule-label">Comments</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <div id="div-id-forum-master-comment"></div>
                            </div>
                        </div>
                    </div>
                    <div id="viewissuesidebar" class="aui-item issue-side-column">
                        <div id="peoplemodule" class="module toggle-wrap">
                            <div id="peoplemodule_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="People" aria-controls="peoplemodule"
                                        aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="peoplemodule-label">People</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <div class="item-details people-details" id="peopledetails">
                                    <dl>
                                        <dt title="Assignee">
                                            <label for="assignee-field">Assignee:</label>
                                        </dt>
                                        <dd>
                                            <span id="assignee-val" class="view-issue-field">
                                                <span class="aui-avatar aui-avatar-small">
                                                    <span class="aui-avatar-inner">
                                                        <img src="{{ ticket.assignee.profile.profilePicture.url }}"
                                                             alt="{{ ticket.assignee.get_full_name }}">
                                                    </span>
                                                </span>
                                                {{ ticket.assignee.get_full_name }}
                                            </span>
                                        </dd>
                                    </dl>
                                    <dl>
                                        <dt title="Reporter">
                                            <label for="reporter-field">Reporter:</label>
                                        </dt>
                                        <dd>
                                            <span id="reporter-val" class="view-issue-field">
                                                <span class="user-hover" id="issue_summary_reporter_dumam"
                                                      rel="{{ ticket.reporter.get_full_name }}">
                                                    <span class="aui-avatar aui-avatar-small">
                                                        <span class="aui-avatar-inner">
                                                            <img src="{{ ticket.reporter.profile.profilePicture.url }}"
                                                                 alt="{{ ticket.reporter.get_full_name }}">
                                                        </span>
                                                    </span>
                                                    {{ ticket.reporter.get_full_name }}
                                                </span>
                                            </span>
                                        </dd>
                                    </dl>
                                </div>
                                <div class="item-details">
                                    <dl>
                                        <dt title="Votes">Votes:</dt>
                                        <dd>
                                            <aui-badge id="vote-data" class="">0</aui-badge>
                                            <span id="vote-label"
                                                  title="You have to be logged in to vote for an issue.">Vote for this issue</span>
                                        </dd>
                                    </dl>
                                    <dl>
                                        <dt title="Watchers">Watchers:</dt>
                                        <dd>
                                            <aui-badge id="watcher-data" class="">2</aui-badge>
                                            <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        <div id="datesmodule" class="module toggle-wrap">
                            <div id="datesmodule_heading" class="mod-header">
                                <button class="aui-button toggle-title" aria-label="Dates" aria-controls="datesmodule"
                                        aria-expanded="true" resolved="">
                                    <span class="accicon"><i class="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <h4 class="toggle-title" id="datesmodule-label">Dates</h4>
                                <ul class="ops"></ul>
                            </div>
                            <div class="mod-content">
                                <div class="item-details">
                                    <dl class="dates">
                                        <dt>
                                            Created:
                                        </dt>
                                        <dd class="date user-tz" title="{{ ticket.createdDttm }}">
                                            <span data-name="Created" id="created-val" data-fieldtype="datetime">
                                                <time class="livestamp" datetime="{{ ticket.createdDttm }}">
                                                    {{ ticket.createdDttm }}
                                                </time>
                                            </span>
                                        </dd>
                                    </dl>
                                    <dl class="dates">
                                        <dt>
                                            Updated:
                                        </dt>
                                        <dd class="date user-tz" title="{{ ticket.modifiedDttm }}">
                                            <span data-name="Updated" id="updated-val" data-fieldtype="datetime">
                                                <time class="livestamp" datetime="{{ ticket.modifiedDttm }}">
                                                    {{ ticket.modifiedDttm }}
                                                </time>
                                            </span>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            renderForumComments({{ticketComments|safe}});
        });

        function verifyLogin() {
            {% if not user.is_authenticated %}
                window.location.href = "{% url 'accounts:login' %}";
            {% endif %}
        }

        function updateReplyModal(masterCommentId) {
            document.getElementById('masterCommentId').value = masterCommentId;
        }

        function createForumComment() {
            var comment = $("#textarea-id-forum-comment").val();
            comment = comment.trim();

            if (comment && !comment.trim() || comment.length === 0) {
                alert("Enter a comment!");
                return;
            }

            $("#textarea-id-forum-comment").val("");

            $.ajax(
                {
                    data: {
                        'functionality': 'createForumComment',
                        'comment': comment
                    },
                    dataType: 'json',
                    success: function (response) {
                        if (response.statusCode == 200) {
                            renderForumComments(response.forum);
                        }
                    }
                });
        }

        function createChildForumComment() {
            var comment = $('textarea#childCommentText').val();
            comment = comment.trim();

            if (comment && !comment.trim() || comment.length === 0) {
                alert("Enter a reply!");
                return;
            }

            $("#replyModal").modal('hide');
            $("textarea#childCommentText").val("");

            $.ajax(
                {
                    data:
                        {
                            'functionality': 'createForumComment',
                            'comment': comment,
                            'masterCommentId': $('#masterCommentId').val(),
                        },
                    dataType: 'json',
                    success: function (response) {
                        if (response.statusCode == 200) {
                            renderForumComments(response.forum);
                        }
                    }
                });
        }

        function renderForumComments(forumComments) {
            if (forumComments.length === 0)
                return;

            var unidentifiedComments = [];

            for (const comment of forumComments) {

                var editDeleteDropdown = '';
                if (comment.canEdit) {
                    editDeleteDropdown = `
					<a href="#" onclick="edit_forum_comment_text_area(` + comment.id + `);"><i class='far fa-edit' style='font-size:15px'></i> Edit</a>
					&nbsp;
					<a href="#" onclick="deleteForumComment(` + comment.id + `);return false;"><i class='far fa-trash-alt' style='font-size:15px'></i> Delete</a>`;
                }

                var forumCommentComponent = `
			<div class="div-id-forum-comment-component` + comment.id + `">
				<div class="">
					<div class="row m-0">
						<div class="">
							<a class="text-decoration-none" href="#">
								<img class="" src="https://cdn3.iconfinder.com/data/icons/avatars-round-flat/33/avat-01-512.png" width="25" height="25" alt="...">
							</a>
						</div>
						<div class="flex-grow-1 pl-2">
							<a class="text-decoration-none" href="#">
								<span class="text-capitalize mb-0">` + comment.creatorFullName + `</span>
								<span class="small text-secondary m-0 mt-1" id="date_and_edited_msg_` + comment.id + `">1 day ago
                {% if f.edited %}(edited){% endif %}</span>
							</a>
						</div>
					</div>
					<div class="">
						<p class="my-2" id="forum_comment_text_` + comment.id + `">
							` + comment.comment + `
						</p>
					</div>
					<footer>
						<span id="forum-comment-like-id-` + comment.id + `" type="button" class="btn btn-default btn-sm" onclick="likeForumComment(` + comment.id + `)">
							<i class='far fa-thumbs-up' style='font-size:15px'></i> (` + comment.likeCount + `)
						</span>
						<span id="forum-comment-dislike-id-` + comment.id + `" type="button" class="btn btn-default btn-sm" onclick="dislikeForumComment(` + comment.id + `)">
							<i class='far fa-thumbs-down' style='font-size:15px'></i> (` + comment.dislikeCount + `)
						</span>
						&nbsp;
						<a href="#"  data-toggle="modal" data-target="#replyModal" onclick="updateReplyModal(` + comment.id + `);return false;"><i class='far fa-comment-alt' style='font-size:15px'></i> Reply</a>
						&nbsp;
						` + editDeleteDropdown + `
					</footer>
					<hr>
					<div class="div-class-child-comments-container` + comment.id + `"></div>
				</div>
			</div>`;

                if (!comment.masterCommentId) {
                    // master comment. reply field is null.
                    $('#div-id-forum-master-comment').prepend(forumCommentComponent);
                } else {
                    // this comment does have a master comment. Needs to be under appropriate comment object.
                    if ($('.div-class-child-comments-container' + comment.masterCommentId)[0])
                        $('.div-class-child-comments-container' + comment.masterCommentId).append(forumCommentComponent);
                    else
                        unidentifiedComments.push(comment);
                }
            }

            return renderForumComments(unidentifiedComments);
        }

        function deleteForumComment(commentId) {
            if (!confirm('Are you sure you want to delete it?'))
                return;

            $.ajax(
                {
                    data:
                        {
                            'functionality': 'deleteForumComment',
                            'id': commentId
                        },
                    dataType: 'json',
                    success: function (response) {
                        if (response.statusCode == 200 || response.statusCode == 404) {
                            location.reload();
                        }
                    }
                }
            );
        }


        // --------------------------------------------------------------------------- //

        // --------------------------------------------------------------------------- //

        function likeForumComment(commentId) {
            // TODO: NotImplemented
            verifyLogin();
            $.ajax(
                {
                    data:
                        {
                            'functionality': 'likeForumComment'
                        },
                    url: '/forum/api/v1/forumCommentOperations/' + commentId,
                    dataType: 'json',
                    success: function (response) {
                        if (response.statusCode == 200) {
                            $('#forum-comment-like-id-' + commentId).html('<i class="far fa-thumbs-up" style="font-size:15px"></i> (' + response.likeCount + ')');
                            $('#forum-comment-dislike-id-' + commentId).html('<i class="far fa-thumbs-down" style="font-size:15px"></i> (' + response.dislikeCount + ')');
                        }

                        if (response.statusCode == 404) {
                            Swal.fire(
                                {
                                    icon: 'warning',
                                    title: "Can't do that!",
                                    text: response.message
                                }
                            );
                        }
                    }
                }
            );
        }

        function dislikeForumComment(commentId) {
            // TODO: NotImplemented
            verifyLogin();

            $.ajax(
                {
                    data:
                        {
                            'functionality': 'dislikeForumComment'
                        },
                    url: '/forum/api/v1/forumCommentOperations/' + commentId,
                    dataType: 'json',
                    success: function (response) {
                        if (response.statusCode == 200) {
                            $('#forum-comment-like-id-' + commentId).html('<i class="far fa-thumbs-up" style="font-size:15px"></i> (' + response.likeCount + ')');
                            $('#forum-comment-dislike-id-' + commentId).html('<i class="far fa-thumbs-down" style="font-size:15px"></i> (' + response.dislikeCount + ')');
                        }

                        if (response.statusCode == 404) {
                            Swal.fire(
                                {
                                    icon: 'warning',
                                    title: "Can't do that!",
                                    text: response.message
                                }
                            );
                        }
                    }
                }
            );
        }

        function updateWatchers(isWatching, watchingCount, forumId) {
            var forumWatchContainer = null;
            if (isWatching)
                forumWatchContainer = `<span onclick="watchUnwatchForum(` + forumId + `);" data-toggle="tooltip" data-placement="top" title="You are watching this issue. Click to stop watching this issue."><i class='far fa-eye' style='font-size:15px'></i> (` + watchingCount + `) Unwatch</span>`;
            else
                forumWatchContainer = `<span onclick="watchUnwatchForum(` + forumId + `);" data-toggle="tooltip" data-placement="top" title="You are not watching this issue. Click to watch this issue."><i class='far fa-eye' style='font-size:15px'></i> (` + watchingCount + `) Watch</span>`;

            $('a#a-id-forum-watcher' + forumId).html(forumWatchContainer);
        }

        function watchUnwatchForum(forumId) {
            // TODO: NotImplemented
            $.ajax(
                {
                    data:
                        {
                            'functionality': 'watchUnwatchForum',
                        },
                    url: '/forum/api/v1/forumOperations/' + forumId,
                    dataType: 'json',
                    success: function (response) {
                        if (response.statusCode == 200) {
                            updateWatchers(response.isWatching, response.newWatchCount, forumId);
                        } else {
                            Swal.fire(
                                {
                                    icon: 'warning',
                                    title: "Can't do that!",
                                    text: response.message
                                }
                            );
                        }
                    }
                });
        }

        $('#priority').selectpicker();
    </script>
{% endblock %}