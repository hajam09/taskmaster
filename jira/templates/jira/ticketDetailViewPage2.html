{% extends "accounts/base.html" %}
{% load static %}
{% block content %}

    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <link type="text/css" rel="stylesheet" href="{% static 'css/ticketPageCss1.css' %}" media="all">
    <link type="text/css" rel="stylesheet" href="{% static 'css/ticketPageCss2.css' %}" media="all">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">


    <div id="issue-content" class="issue-edit-form">
    </div>


    <script type="text/babel">

        class TicketHeaderComponent extends React.Component {
            constructor(props) {
                super(props);
            }

            render() {
                const style1 = {
                    backgroundColor: '#f5f6f8'
                }
                return (
                    <header id="stalker" className="issue-header js-stalker">
                        <div className="issue-header-content">
                            <div className="aui-page-header">
                                <div className="aui-page-header-inner">
                                    <div className="aui-page-header-image">
                                <span id="10172" className="aui-avatar aui-avatar-large aui-avatar-project">
                                    <span className="aui-avatar-inner">
                                        <img id="project-avatar"
                                             alt={"Uploaded image for project: " + this.props.ticket.project.internalKey}
                                             src={this.props.ticket.project.icon}></img>
                                    </span>
                                </span>
                                    </div>
                                    <div className="aui-page-header-main">
                                        <ol className="aui-nav aui-nav-breadcrumbs" resolved="">
                                            <li>
                                                <a id="project-name-val"
                                                   href={this.props.ticket.project.link}
                                                   className="">{this.props.ticket.project.internalKey}</a>
                                            </li>
                                            &nbsp;
                                            <li>
                                                <a className="issue-link" data-issue-key={this.props.ticket.link}
                                                   href={this.props.ticket.link} id="key-val"
                                                   rel="215653">{this.props.ticket.internalKey}</a>
                                            </li>
                                        </ol>
                                        <h1 id="summary-val">{this.props.ticket.summary} </h1>
                                    </div>
                                </div>
                                <button type="button" className="btn" data-toggle="modal"
                                        style={style1}
                                        data-target="#editTicketModal">Edit
                                </button>
                            </div>
                        </div>
                    </header>
                )
            }
        }

        class TicketDatesComponent extends React.Component {
            constructor(props) {
                super(props);
            }

            render() {
                return (
                    <div id="datesmodule" className="module toggle-wrap">
                        <div id="datesmodule_heading" className="mod-header">
                            <button className="aui-button toggle-title" aria-label="Dates" aria-controls="datesmodule"
                                    aria-expanded="true" resolved="">
                                <span className="accicon"><i className="fas fa-angle-down rotate-icon"></i></span>
                            </button>
                            <h4 className="toggle-title" id="datesmodule-label">Dates</h4>
                            <ul className="ops"></ul>
                        </div>
                        <div className="mod-content">
                            <div className="item-details">
                                <dl className="dates">
                                    <dt>
                                        Created:
                                    </dt>
                                    <dd className="date user-tz" title={this.props.ticket.createdDate}>
                                            <span data-name="Created" id="created-val" data-fieldtype="datetime">
                                                <time className="livestamp" dateTime={this.props.ticket.createdDate}>
                                                    {this.props.ticket.createdDate}
                                                </time>
                                            </span>
                                    </dd>
                                </dl>
                                <dl className="dates">
                                    <dt>
                                        Updated:
                                    </dt>
                                    <dd className="date user-tz" title={this.props.ticket.modifiedDate}>
                                            <span data-name="Updated" id="updated-val" data-fieldtype="datetime">
                                                <time className="livestamp" dateTime={this.props.ticket.modifiedDate}>
                                                    {this.props.ticket.modifiedDate}
                                                </time>
                                            </span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                )
            }
        }

        class TicketDetailsComponent extends React.Component {
            constructor(props) {
                super(props);
            }

            render() {

                const style1 = {
                    backgroundColor: this.props.ticket.column.colour,
                    color: 'white',
                }
                const style2 = {
                    backgroundColor: ' #DFE1E5',
                }
                const style3 = {
                    height: "auto"
                }
                return (
                    <div id="details-module" className="module toggle-wrap">
                        <div id="details-module_heading" className="mod-header">
                            <button className="aui-button toggle-title" aria-label="Details"
                                    aria-controls="details-module" aria-expanded="true" resolved="">
                                <span className="accicon"><i className="fas fa-angle-down rotate-icon"></i></span>
                            </button>
                            <h4 className="toggle-title" id="details-module-label">Details</h4>
                            <ul className="ops"></ul>
                        </div>
                        <div className="mod-content">
                            <ul id="issuedetails" className="property-list two-cols">
                                <li className="item">
                                    <div className="wrap">
                                        <strong className="name" title="Type">
                                            <label htmlFor="issuetype">Type:</label>
                                        </strong>
                                        <span id="type-val" className="value">
                                                <img alt={this.props.ticket.issueType.internalKey} height="16"
                                                     src={this.props.ticket.issueType.icon}
                                                     title={this.props.ticket.issueType.internalKey}
                                                     width="16"></img>
                                            &nbsp;&nbsp;
                                            {this.props.ticket.issueType.internalKey}
                                            </span>
                                    </div>
                                </li>
                                <li className="item item-right">
                                    <div className="wrap">
                                        <strong className="name" title="Status">Status:</strong>
                                        <span id="status-val" className="value">
                                                <span
                                                    className=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-yellow jira-issue-status-lozenge-indeterminate jira-issue-status-lozenge-max-width-medium"
                                                    style={style1}>
                                                    {this.props.ticket.column.internalKey}
                                                </span>
                                            </span>
                                    </div>
                                </li>
                                <li className="item new">
                                    <div className="wrap">
                                        <strong className="name" title="Priority">
                                            <label htmlFor="priority-field">Priority:</label>
                                        </strong>
                                        <span id="priority-val" className="value">
                                                <img alt={this.props.ticket.priority.internalKey} height="16"
                                                     src={this.props.ticket.priority.icon}
                                                     title={this.props.ticket.priority.internalKey}
                                                     width="16"></img>
                                            &nbsp;&nbsp;
                                            {this.props.ticket.priority.internalKey}
                                            </span>
                                    </div>
                                </li>
                                <li className="item item-right">
                                    <div className="wrap">
                                        <strong className="name" title="Resolution">Resolution:</strong>
                                        <span id="resolution-val"
                                              className={"value " + this.props.ticket.resolution.internalKey}> {this.props.ticket.resolution.internalKey} </span>
                                    </div>
                                </li>
                                <li className="item">
                                    <div className="wrap">
                                        <strong className="name" title="Component/s">
                                            <label htmlFor="components">Component/s:</label>
                                        </strong>
                                        <span id="components-val" className="value">
                                              <span className="shorten" id="components-field" resolved=""
                                                    style={style3}>
                                                  {
                                                      this.props.ticket.components.map((component, i) =>
                                                          <a key={i} title="core Jenkins core"
                                                             href={"{% url 'jira:issuesListView' %}?projects=" + this.props.ticket.project.code + "&component=" + component.internalKey}>
                                                              {component.internalKey}&nbsp;&nbsp;
                                                          </a>
                                                      )
                                                  }
                                              </span>
                                          </span>
                                    </div>
                                </li>

                                <li className="item item-right">
                                    <div className="wrap">
                                        <strong className="name" title="StoryPoint">Story Point:</strong>
                                        <span id="storyPoint-val" className={"value " + this.props.ticket.storyPoints}>
                                            {this.props.ticket.storyPoints}
                                        </span>
                                    </div>
                                </li>

                                <li className="item">
                                    <div className="wrap" id="wrap-labels">
                                        <strong className="name" title="Labels"> <label
                                            htmlFor="labels-textarea">Labels:</label> </strong>
                                        {
                                            this.props.ticket.labels.map((label, i) =>
                                                <div className="labels-wrap value" key={i}>
                                                    <a href="/issues/?jql=labels+%3D+regression" className="aui-lozenge"
                                                       style={style2}
                                                       title={label.internalKey}>
                                                        {label.internalKey}
                                                    </a>
                                                </div>
                                            )
                                        }
                                    </div>
                                </li>

                                <li className="item item-right">
                                    <div className="wrap">
                                        <strong className="name" title="fixVersion">Fix version:</strong>
                                        <span id="fixVersion-val" className={"value " + this.props.ticket.fixVersion}>
                                            {this.props.ticket.fixVersion}
                                        </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                )
            }
        }

        class TicketPeopleComponent extends React.Component {
            constructor(props) {
                super(props);

                const icon = 'https://cdn3.iconfinder.com/data/icons/avatars-round-flat/33/man5-512.png';

                let unassignedProfile = {
                    id: 0,
                    fullName: "Unassigned",
                    icon: icon
                }

                let assignee = Object.keys(this.props.assignee).length === 0 ? unassignedProfile : this.props.assignee;
                let reporter = Object.keys(this.props.reporter).length === 0 ? unassignedProfile : this.props.reporter;

                this.state = {
                    assignee: assignee,
                    reporter: reporter,
                }
            }

            render() {
                return (
                    <div id="peoplemodule" className="module toggle-wrap">
                        <div id="peoplemodule_heading" className="mod-header">
                            <button className="aui-button toggle-title" aria-label="People" aria-controls="peoplemodule"
                                    aria-expanded="true" resolved="">
                                <span className="accicon">
                                    <i className="fas fa-angle-down rotate-icon"></i>
                                </span>
                            </button>
                            <h4 className="toggle-title" id="peoplemodule-label">People</h4>
                            <ul className="ops"></ul>
                        </div>
                        <div className="mod-content">
                            <div className="item-details people-details" id="peopledetails">
                                <dl>
                                    <dt title="Assignee">
                                        <label htmlFor="assignee-field">Assignee:</label>
                                    </dt>
                                    <dd>
                                        <span id="assignee-val" className="view-issue-field">
                                            <span className="aui-avatar aui-avatar-small">
                                                <span className="aui-avatar-inner">
                                                    <img
                                                        src={this.state.assignee.icon}
                                                        alt={this.state.assignee.fullName}></img>
                                                </span>
                                            </span>&nbsp;&nbsp;
                                            {this.state.assignee.fullName}
                                        </span>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt title="Reporter">
                                        <label htmlFor="reporter-field">Reporter:</label>
                                    </dt>
                                    <dd>
                                        <span id="reporter-val" className="view-issue-field">
                                            <span className="user-hover" id="issue_summary_reporter_dumam"
                                                  rel={this.state.reporter.fullName}>
                                                <span className="aui-avatar aui-avatar-small">
                                                    <span className="aui-avatar-inner">
                                                        <img src={this.state.reporter.icon}
                                                             alt={this.state.reporter.fullName}></img>
                                                    </span>
                                                </span>
                                                &nbsp;&nbsp;
                                                {this.state.reporter.fullName}
                                            </span>
                                        </span>
                                    </dd>
                                </dl>
                            </div>
                            <div className="item-details">
                                <dl>
                                    <dt title="Votes">Votes:</dt>
                                    <dd>
                                        <aui-badge id="vote-data" className="">0</aui-badge>
                                        <span id="vote-label"
                                              title="You have to be logged in to vote for an issue.">Vote for this issue</span>
                                    </dd>
                                </dl>
                                <dl>
                                    <dt title="Watchers">Watchers:</dt>
                                    <dd>
                                        <aui-badge id="watcher-data" className="">2</aui-badge>
                                        <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span>
                                    </dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                )
            }
        }

        class TicketDescriptionComponent extends React.Component {
            constructor(props) {
                super(props);
            }

            render() {

                const style1 = {
                    whiteSpace: "pre-line"
                }
                return (
                    <div id="descriptionModule" className="module toggle-wrap">
                        <div id="descriptionModule_heading" className="mod-header">
                            <button className="aui-button toggle-title" aria-label="Description"
                                    aria-controls="descriptionModule" aria-expanded="true" resolved="">
                                <span className="accicon"><i className="fas fa-angle-down rotate-icon"></i></span>
                            </button>
                            <h4 className="toggle-title" id="descriptionmodule-label">Description</h4>
                            <ul className="ops"></ul>
                        </div>
                        <div className="mod-content">
                            <div id="description-val" className="field-ignore-highlight">
                                <div className="user-content-block" style={style1}>
                                    {this.props.ticket.description}
                                </div>
                            </div>
                        </div>
                    </div>
                )
            }
        }

        class TicketBar extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    assigneeIcon: this.props.ticket.assignee.icon ? this.props.ticket.assignee.icon : "https://cdn3.iconfinder.com/data/icons/avatars-round-flat/33/man5-512.png",
                    assigneeName: this.props.ticket.assignee.fullName ? this.props.ticket.assignee.fullName : "Unassigned"
                }
            }

            render() {
                const style1 = {
                    height: "10px"
                }
                const style2 = {
                    marginTop: "-13px",
                    marginLeft: "-10px"
                }

                const style3 = {
                    marginTop: "-12px",
                    marginLeft: "-15px"
                }

                return (
                    <div className="card grabbable" id={this.props.ticket.id}>
                        <div className="card-body" style={style1}>
                            <div className="row">
                                <div className="col-auto" style={style2}>
                                    <img src={this.props.ticket.issueType.icon} width="20" height="20"
                                         data-toggle="tooltip"
                                         data-placement="top" title={this.props.ticket.issueType.internalKey}></img>
                                </div>
                                <div className="col-auto" style={style3}>
                                    <a href={this.props.ticket.url}>{this.props.ticket.internalKey}</a>
                                </div>
                                <div className="col" style={style3}>
                                    <span>{this.props.ticket.summary}</span>
                                </div>
                                <div className="col-auto" style={style2}>
                                    <img src={this.props.ticket.priority.icon} width="20" height="20"
                                         data-toggle="tooltip"
                                         data-placement="top" title={this.props.ticket.priority.internalKey}></img>
                                </div>
                                <div className="col-auto" style={style2}>
                                    <img src={this.state.assigneeIcon} width="25" height="25"
                                         data-toggle="tooltip" data-placement="top"
                                         title={this.state.assigneeName}></img>
                                </div>
                            </div>
                        </div>
                    </div>
                )
            }
        }

        class LinkingModuleHead extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    heading: this.props.isEpic ? "Issues in the epic" : "Subtasks"
                }
            }

            render() {

                const style1 = {
                    fontSize: "24px",
                    cursor: "pointer"
                }
                return (
                    <div id="linkingmodule_heading" className="mod-header">
                        <button className="aui-button toggle-title" aria-label="Issue Links"
                                aria-controls="linkingmodule" aria-expanded="true" resolved="">
                            <span className="accicon">
                                <i className="fas fa-angle-down rotate-icon"></i>
                            </span>
                        </button>
                        <div className="row">
                            <div className="col">
                                <p className="font-weight-bold">{this.state.heading}</p>
                            </div>
                            <div className="col-auto">
                                <i className="fa fa-plus-square float-right"
                                   style={style1} onClick={this.props.switchCreateMode}
                                ></i>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        class LinkingModuleBody extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    issueType: null,
                    summary: null,
                }
            }

            renderNormalMode = () => {
                return <div></div>
            }

            createNewTicket = () => {
                fetch('{% url 'jira:ticketObjectForEpicTicketApiEventVersion1Component' %}', {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json',
                    },
                    body: JSON.stringify({
                        'ticketId': this.props.ticket.id,
                        'ticketSummary': this.refs.summaryInput.value,
                        'issueType': this.refs.issueTypeInput.value,
                    })
                }).then((response) => {
                    this.props.fetchEpicTasks()
                    this.props.switchCreateMode()
                })
            }

            createSubTask = () => {
                fetch('{% url 'jira:subTaskTicketObjectForTicketApiEventVersion1Component' %}', {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json',
                    },
                    body: JSON.stringify({
                        'ticketId': this.props.ticket.id,
                        'ticketSummary': this.refs.summaryInput.value,
                    })
                }).then((response) => {
                    this.props.fetchSubTasks()
                    this.props.switchCreateMode()
                })
            }

            renderNewTicketMode = () => {
                const style1 = {
                    marginRight: "25px"
                }
                if (this.props.isEpic) {
                    return (
                        <div id="new-ticket-creator">
                            <div className="row">
                                <div className="col-4">
                                    <select id="issueType" data-show-content="true" className="form-control"
                                            ref="issueTypeInput">
                                        {% for ji in ticketIssueTypes %}
                                            {% if ji.code == "STORY" %}
                                                <option
                                                    data-content="<img src='{% static ji.icon %}' width='20' height='20'>&nbsp; {{ ji }}"
                                                    defaultValue="{{ ji.code }}"
                                                    selected="selected">{{ ji.internalKey }}</option>
                                            {% else %}
                                                <option
                                                    data-content="<img src='{% static ji.icon %}' width='20' height='20'>&nbsp; {{ ji }}"
                                                    defaultValue="{{ ji.code }}">{{ ji.internalKey }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div className="col-8">
                                    <input className="form-control pull-right" id="new-ticket-name" type="text"
                                           ref="summaryInput"
                                           placeholder="What needs to be done?"></input>
                                </div>
                            </div>
                            <br></br>
                            <div>
                                <button type="button" className="btn btn-primary pull-right"
                                        onClick={this.createNewTicket}>Create
                                </button>
                                <button type="button" className="btn btn-light pull-right" style={style1}
                                        onClick={this.props.switchCreateMode}>Cancel
                                </button>
                            </div>
                        </div>
                    )
                } else {
                    return (
                        <div id="subtask-tickets-container">
                            <div id="subtask-tickets-creator">
                                <input className="form-control" id="new-sub-task-name" type="text" ref="summaryInput"
                                       placeholder="What needs to be done in this sub task?"></input>
                                <br></br>
                                <button type="button" className="btn btn-primary pull-right"
                                        onClick={this.createSubTask}>Create
                                </button>
                                <button type="button" className="btn btn-light pull-right" style={style1}
                                        onClick={this.props.switchCreateMode}>Cancel
                                </button>
                            </div>
                        </div>
                    )
                }
            }

            render() {
                return (
                    <div id="tickets-list-container">
                        {this.props.isEpic ? this.props.epicTickets.map((ticket) => <TicketBar key={ticket.id}
                                                                                               ticket={ticket}/>) : this.props.subTaskTickets.map((ticket) =>
                            <TicketBar key={ticket.id} ticket={ticket}/>)}
                        {this.props.inCreateMode ? this.renderNewTicketMode() : this.renderNormalMode()}
                    </div>
                )
            }
        }

        class LinkingModuleComponent extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    isEpic: this.props.ticket.issueType.internalKey === 'Epic',
                    inCreateMode: false,
                    epicTickets: [],
                    subTaskTickets: []
                }

                this.switchCreateMode = this.switchCreateMode.bind(this)
                this.fetchEpicTasks = this.fetchEpicTasks.bind(this)
                this.fetchSubTasks = this.fetchSubTasks.bind(this)
            }

            componentDidMount = () => {
                if (this.state.isEpic)
                    this.fetchEpicTasks()
                else
                    this.fetchSubTasks()
            }

            fetchEpicTasks() {
                fetch('{% url 'jira:ticketsForEpicTicketApiEventVersion1Component' ticketId=ticket.id %}')
                    .then(response => response.json())
                    .then(data => this.setState({
                        epicTickets: data.data.tickets
                    }))
            }

            fetchSubTasks() {
                fetch('{% url 'jira:subTaskTicketsForTicketApiEventVersion1Component' ticketId=ticket.id %}')
                    .then(response => response.json())
                    .then(data => this.setState({
                        subTaskTickets: data.data.tickets
                    }))
            }

            switchCreateMode = () => {
                this.setState({
                    inCreateMode: !this.state.inCreateMode
                })
            }

            render() {
                return (
                    <div id="linkingmodule" className="module toggle-wrap">
                        <LinkingModuleHead isEpic={this.state.isEpic} inCreateMode={this.state.inCreateMode}
                                           switchCreateMode={this.switchCreateMode}/>
                        <br></br>
                        <LinkingModuleBody isEpic={this.state.isEpic} inCreateMode={this.state.inCreateMode}
                                           switchCreateMode={this.switchCreateMode} epicTickets={this.state.epicTickets}
                                           fetchEpicTasks={this.fetchEpicTasks} fetchSubTasks={this.fetchSubTasks}
                                           subTaskTickets={this.state.subTaskTickets} ticket={this.props.ticket}/>
                    </div>
                );
            }
        }

        class ActivityModuleHead extends React.Component {
            constructor(props) {
                super(props);
            }

            render() {

                const style1 = {
                    fontSize: "24px",
                    cursor: "pointer"
                }
                return (
                    <div id="activitymodule_heading" className="mod-header">
                        <button className="aui-button toggle-title" aria-label="Activity"
                                aria-controls="activitymodule" aria-expanded="true" resolved="">
                            <span className="accicon"><i className="fas fa-angle-down rotate-icon"></i></span>
                        </button>
                        <div className="row">
                            <div className="col">
                                <p className="font-weight-bold">Comments</p>
                            </div>
                            <div className="col-auto">
                                <i className="fa fa-plus-square float-right"
                                   style={style1} onClick={this.props.switchCreateMode}
                                ></i>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        class TicketCommentInstanceComponent extends React.Component {
            constructor(props) {
                super(props);
                console.log(this.props.comment)
            }

            render() {
                return (
                    <div id={"comment-"+this.props.comment.id}
                         className="issue-data-block activity-comment twixi-block expanded">
                        <div className="twixi-wrap verbose actionContainer">
                            <div className="action-head">
                                <button title="Collapse comment" className="aui-button toggle-title" aria-label="Collapse comment" aria-expanded="true" resolved="">
                                    <span className="accicon"><i className="fas fa-angle-down rotate-icon"></i></span>
                                </button>
                                <div className="action-details">
                                    {##}
                                    {#<a className="user-hover user-avatar" rel="bf31e0818161"#}
                                    {#   id="commentauthor_3025721_verbose"#}
                                    {#   href="/secure/ViewProfile.jspa?name=bf31e0818161"><span#}
                                    {#    className="aui-avatar aui-avatar-xsmall"><span#}
                                    {#    className="aui-avatar-inner"><img#}
                                    {#    src="https://jira.atlassian.com/secure/useravatar?size=xsmall&amp;avatarId=10612"#}
                                    {#    alt="bf31e0818161"></span></span> John Price</a>#}
                                    {#added a comment - <a#}
                                    {#href="/browse/JSDCLOUD-630?focusedCommentId=3025721&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-3025721"#}
                                    {#className="commentdate_3025721_verbose subText comment-created-date-link"><span#}
                                    {#className="date user-tz" title="12/Apr/2022 5:37 PM"><time#}
                                    {#className="livestamp" datetime="2022-04-12T17:37:36+0000">12/Apr/2022 5:37 PM</time></span></a>#}
                                </div>
                            </div>
                            <div className="action-body flooded">
                                <p>
                                    {this.props.comment.comment}
                                </p>
                            </div>
                            <div className="action-links action-comment-actions">
                            </div>
                        </div>
                    </div>
            )
            }
        }

        class ActivityModuleBody extends React.Component {
            constructor(props) {
                super(props);
            }

            renderNormalMode = () => {
                return <div></div>
            }

            createNewComment = () => {
                fetch('{% url 'jira:ticketCommentObjectApiEventVersion1Component' %}', {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json',
                    },
                    body: JSON.stringify({
                        'ticketId': this.props.ticket.id,
                        'comment': this.refs.comment.value,
                    })
                }).then((response) => {
                    this.props.fetchComments()
                })
            }

            renderNewCommentMode = () => {

            }

            render() {
                return (
                    <div id="ticket-comment-list-container">
                        {this.props.comments.map((comment) => <TicketCommentInstanceComponent key={comment.id}
                                                                                             comment={comment}/>)}
                    </div>
                )
            }

        }


        class TicketActivityModuleComponent extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    inCreateMode: false,
                    comments: []
                }
                this.switchCreateMode = this.switchCreateMode.bind(this)
                this.fetchComments = this.fetchComments.bind(this)
            }

            componentDidMount = () => {
                this.fetchComments();
            }

            fetchComments() {
                fetch('{% url 'jira:ticketCommentsApiEventVersion1Component' ticketId=ticket.id %}')
                    .then(response => response.json())
                    .then(data => this.setState({
                        comments: data.data.comments
                    }))
            }

            switchCreateMode = () => {
                this.setState({
                    inCreateMode: !this.state.inCreateMode
                })
            }

            render() {
                return (
                    <div id="activitymodule" className="module toggle-wrap">
                        <ActivityModuleHead inCreateMode={this.state.inCreateMode}
                                            switchCreateMode={this.switchCreateMode}/>
                        <br></br>
                        <ActivityModuleBody inCreateMode={this.state.inCreateMode}
                                            comments={this.state.comments}
                                            switchCreateMode={this.switchCreateMode}
                                            fetchComments={this.fetchComments}
                                            ticket={this.props.ticket}/>
                    </div>
                )
            }
        }

        class TicketViewComponent extends React.Component {
            constructor(props) {
                super(props);

                this.state = {
                    ticket: {{ ticket|safe }}
                }

                console.log(this.state.ticket)
            }

            render() {
                return (
                    <div>
                        <TicketHeaderComponent ticket={this.state.ticket}/>
                        <div className="issue-body-content">
                            <div className="aui-group issue-body">

                                <div className="aui-item issue-main-column">
                                    <TicketDetailsComponent ticket={this.state.ticket}/>
                                    <TicketDescriptionComponent ticket={this.state.ticket}/>
                                    <LinkingModuleComponent ticket={this.state.ticket}/>
                                    <TicketActivityModuleComponent ticket={this.state.ticket}/>
                                </div>

                                <div id="view-issue-sidebar" className="aui-item issue-side-column">
                                    <TicketPeopleComponent assignee={this.state.ticket.assignee}
                                                           reporter={this.state.ticket.reporter}/>
                                    <TicketDatesComponent ticket={this.state.ticket}/>
                                </div>

                            </div>
                        </div>
                    </div>
                )
            }
        }

        ReactDOM.render(<TicketViewComponent/>, document.getElementById('issue-content'));
    </script>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
{% endblock %}